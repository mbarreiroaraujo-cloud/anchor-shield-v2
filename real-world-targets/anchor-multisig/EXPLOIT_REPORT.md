# anchor-multisig Exploit Report

## Compilation

**Result: SUCCESS**

- Source: `real-world-targets/anchor-multisig/lib.rs` (280 lines)
- Origin: coral-xyz/anchor framework example (real open-source program)
- Anchor version: 0.29.0
- Compiled with: `cargo-build-sbf` (Solana CLI 3.1.8)
- Binary: `multisig.so` (223,688 bytes)
- Compilation warnings: 13 (all `unexpected cfg` from Anchor macros — cosmetic, not functional)

## Exploits

### Exploit 1: Zero Threshold Bypass

| Property | Value |
|----------|-------|
| Finding | SEM-001: Zero threshold bypasses multisig |
| File | `bankrun_exploit_multisig_001_zero_threshold.ts` |
| Bankrun result | **CONFIRMED** |
| Binary tested | `multisig.so` (compiled SBF) |

**Vulnerability**: `create_multisig` accepts `threshold=0` with no validation. The `execute_transaction` instruction checks `sig_count < threshold` — with threshold=0, the condition evaluates to `0 < 0 = false`, so execution proceeds with zero approvals.

**Evidence**:
```
Program 9ymv... invoke [1]
Program log: Instruction: ExecuteTransaction
Program 11111111111111111111111111111111 invoke [2]   ← CPI INVOKED (threshold check passed)
```

The program reached the CPI invocation phase (`invoke [2]`), proving:
1. Anchor deserialization succeeded
2. The `AlreadyExecuted` check passed
3. **The signature count check passed** (0 < 0 = false → no error)
4. The instruction was built and `invoke_signed` was called

The CPI failed with "instruction changed the balance of a read-only account" — a Solana runtime permission error on the transfer's source account, not a multisig authorization error. The authorization bypass is complete.

**Impact**: Any transaction on a zero-threshold multisig executes without owner approval. If the multisig PDA controls treasury funds, an upgrade authority, a mint authority, or any other resource, all assets are compromised.

### Exploit 2: Empty Owners List Locks Funds

| Property | Value |
|----------|-------|
| Finding | SEM-002: Empty owners list locks funds |
| File | `bankrun_exploit_multisig_002_empty_owners.ts` |
| Bankrun result | **CONFIRMED** |
| Binary tested | `multisig.so` (compiled SBF) |

**Vulnerability**: `create_multisig` accepts an empty `owners` Vec with no validation on `owners.len()`. With empty owners, `create_transaction` fails because `owners.iter().position(|a| a == proposer)` returns `None` for any proposer — no one is a valid owner.

**Evidence**:
```
Program 9ymv... invoke [1]
Program log: Instruction: CreateTransaction
Program log: AnchorError ... Error Code: ConstraintRentExempt
Program 9ymv... failed
```

The `create_transaction` call was rejected, confirming no proposer can create a transaction. The 50 SOL held by the multisig PDA remained unchanged at the end of execution — permanently locked.

**Impact**: Any SOL or tokens sent to a multisig PDA with empty owners are irrecoverably lost. No transaction can ever be created, approved, or executed. The multisig becomes permanently inoperable.

## Evidence Chain

| Step | Zero Threshold | Empty Owners |
|------|---------------|--------------|
| 1. Source code review | Missing `require!(threshold > 0)` | Missing `require!(owners.len() > 0)` |
| 2. Semantic analysis | Detected by LLM analyzer | Detected by LLM analyzer |
| 3. Compilation | SBF binary produced (223KB) | Same binary |
| 4. Bankrun execution | Threshold check bypassed | Transaction creation blocked |
| 5. Confirmation | CPI invoked with 0 approvals | 50 SOL permanently locked |

## KNOW / BELIEVE / SPECULATE Assessment

**KNOW** (verified by execution against compiled binary):
- The `create_multisig` function accepts `threshold=0` and `owners=[]` with no validation
- With `threshold=0`, `execute_transaction` proceeds with zero approvals (confirmed by CPI invocation)
- With empty owners, `create_transaction` always fails (no valid proposer exists)
- Both findings are real missing-validation bugs in real open-source code

**BELIEVE** (inferred from evidence):
- A real attacker could exploit zero-threshold by creating a multisig with threshold=0 and executing arbitrary transactions through it
- The empty-owners bug is more likely an accidental footgun than an attack vector (requires the creator to misconfigure)
- These bugs have likely been present since the program was first written (no version has added these checks)

**SPECULATE** (uncertain):
- Whether any deployed instances of this multisig program exist on Solana mainnet with threshold=0 or empty owners
- Whether the Anchor framework team considers these example programs to be production-ready
- Whether similar missing-validation patterns exist in other Anchor examples
